<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">
    <changeSet id="0001-1" author="kartven">
        <createTable tableName="users">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_users"/>
            </column>
            <column name="role" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="is_expired" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="is_locked" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="staffs">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_staffs"/>
            </column>
            <column name="key_id" type="VARCHAR(20)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="first_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_street" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_home" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_zip_code" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_city" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="phone" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_students_user" references="users(id)"/>
            </column>
        </createTable>

        <createIndex indexName="idx_key_id" tableName="staffs">
            <column name="key_id"/>
        </createIndex>

        <createTable tableName="students">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_students"/>
            </column>
            <column name="first_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_street" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_home" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_zip_code" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_city" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="phone" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_students_user" references="users(id)"/>
            </column>
        </createTable>

        <createTable tableName="faculties">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_faculties"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="short_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="year_founded" type="INT"/>
            <column name="address_street" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_zip_code" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="address_city" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="works">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_works"/>
            </column>
            <column name="type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="position_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="staff_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" foreignKeyName="fk_works_staff" references="staffs(id)"/>
            </column>
            <column name="faculty_id" type="BIGINT">
                <constraints nullable="true" primaryKey="true" foreignKeyName="fk_works_faculty" references="faculties(id)"/>
            </column>
        </createTable>

        <createTable tableName="courses">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_courses"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="faculty_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_courses_faculty" references="faculties(id)"/>
            </column>
        </createTable>

        <createTable tableName="programmes">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_programmes"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="short_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="course_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_programmes_course" references="courses(id)"/>
            </column>
        </createTable>

        <createTable tableName="modules">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_modules"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="short_name" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column name="ects" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="hours" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="is_exam" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="programme_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_modules_programme" references="programmes(id)"/>
            </column>
        </createTable>

        <createTable tableName="academic_years">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_academic_years"/>
            </column>
            <column name="mark" type="VARCHAR(9)">
                <constraints nullable="false"/>
            </column>
            <column name="is_closed" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="groups">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_groups"/>
            </column>
            <column name="type" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="number" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="connections">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_connections"/>
            </column>
            <column name="module_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_connections_module" references="modules(id)"/>
            </column>
            <column name="academic_year_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_connections_academic_year" references="academic_years(id)"/>
            </column>
            <column name="group_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_connections_group" references="groups(id)"/>
            </column>
        </createTable>

        <createTable tableName="staff_connections">
            <column name="staff_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" foreignKeyName="fk_stacon_staff" references="staffs(id)"/>
            </column>
            <column name="connection_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" foreignKeyName="fk_stacon_connection" references="connections(id)"/>
            </column>
        </createTable>

        <createTable tableName="student_connections">
            <column name="student_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" foreignKeyName="fk_stucon_student" references="students(id)"/>
            </column>
            <column name="connection_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" foreignKeyName="fk_stucon_connection" references="connections(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="0001-2" author="KartVen" context="test">
        <sql>
            insert into faculties (name, short_name, year_founded, address_street, address_zip_code, address_city, is_active)
            values  ('Wydział Elektrotechniki i Informatyki', 'WEII', 1963, 'ul. Wincentego Pola 2', '35-959', 'Rzeszów', true);
        </sql>

        <sql>
            insert into courses (name, is_active, faculty_id)
            values  ('Informatyka', true, 1);
        </sql>

        <sql>
            insert into programmes (name, short_name, is_active, course_id)
            values  ('Inżynieria systemów informatycznych', 'AA', true, 1),
                    ('Systemy i sieci komputerowe', 'S', true, 1),
                    ('Informatyka w przedsiębiorstwie', 'TT', true, 1);
        </sql>

        <sql>
            insert into modules (name, short_name, ects, hours, is_exam, is_active, programme_id)
            values  ('Programowanie w języku C', 'ProC', 4, 45, true, true, 1),
                    ('Wstęp do programowania', 'Wdp', 4, 45, true, true, 1),
                    ('Narzędzia dla programistów', 'Ndp', 3, 40, true, true, 1);
        </sql>

        <sql>
            insert into academic_years (mark, is_closed)
            values  ('2020/2021', false),
                    ('2023/2024', false);
        </sql>

        <sql>
            insert into groups (type, number)
            values  ('W', 1),
                    ('C', 1),
                    ('L', 1),
                    ('L', 2);
        </sql>

        <sql>
            insert into connections (module_id, academic_year_id, group_id)
            values  (1, 1, 1),
                    (1, 1, 2),
                    (1, 1, 3),
                    (1, 1, 4),
                    (2, 1, 1),
                    (2, 1, 2),
                    (2, 1, 3),
                    (2, 1, 4),
                    (2, 2, 1),
                    (2, 2, 2),
                    (2, 2, 3),
                    (3, 2, 1),
                    (3, 2, 2),
                    (3, 2, 3),
                    (2, 2, 1),
                    (2, 2, 3),
                    (2, 1, 2),
                    (2, 2, 2),
                    (2, 1, 1);
        </sql>

        <sql>
            insert into users (role, password, is_active, is_expired, is_locked)
            values  ('ADMINISTRATOR', '$2a$10$6UDVFisNIAbLkz2eQp7khOm6j3keFZWfO4oXnEb03a0p13iwhwReW', true, false, false),
                    ('ACADEMIC_STAFF', '$2a$10$fGnBSmQM0RUGICkPfCsiV.uDNuv3HHJ58u.OecpPrpNXZQ.yVddoi', true, false, false),
                    ('LECTURER', '$2a$10$G1QCxg4D7H6TD/g8Tx2SjuBa/Dv/K/cd5l1kGPSzD19ZVcG8Es8GG', true, false, false);
        </sql>

        <sql>
            insert into staffs (key_id, first_name, last_name, address_street, address_home, address_zip_code, address_city, email, phone, user_id)
            values  ('kkielbasa', 'Krystian', 'Kiełbasa', 'NazwaUlicy', '1', '35-084', 'Reszów', 'krystian.kiełbasa@email.pl', '123456789', 1),
                    ('anowak', 'Andrzej', 'Nowak', 'NazwaUlicy', '1', '35-084', 'Reszów', 'anowak@email.pl', '123456789', 2),
                    ('jnowak', 'Jan', 'Nowak', 'NazwaUlicy', '1', '35-084', 'Reszów', 'jnowak@email.pl', '123456789', 3);
        </sql>

        <sql>
            insert into works (type, position_name, status, staff_id, faculty_id)
            values  ('ACADEMIC', 'Dziekan', 'PROGRESS', 2, 1);
        </sql>

        <sql>
            insert into staff_connections (staff_id, connection_id)
            values  (3, 15),
                    (3, 16),
                    (3, 17),
                    (3, 18),
                    (3, 19);
        </sql>
    </changeSet>
</databaseChangeLog>